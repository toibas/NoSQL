<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Elasticsearch Log Analyse</title>
</head>
<body>
  <h1>Elasticsearch Log Analyse</h1>

  <section>
    <h2>Verbindung testen</h2>
    <button onclick="testAPI()">API erreichbar?</button>
    <button onclick="testDatabase()">Elasticsearch erreichbar?</button>
    <pre id="testResult"></pre>
  </section>

  <section>
    <h2>Log-Datei hochladen (.log oder .json)</h2>
    <input type="file" id="logfileInput" />
    <button onclick="uploadLog()">Hochladen</button>
    <pre id="uploadResult"></pre>
  </section>

  <section>
    <button onclick="window.location.href='analyse.html'">Zur Analyse</button>
  </section>

  <script src="config.js"></script>
  <script>
    async function apiCall(url, method = 'GET', data = null) {
      try {
        const options = { method };
        if (data) {
          options.headers = { 'Content-Type': 'application/json' };
          options.body = JSON.stringify(data);
        }
        const res = await fetch(url, options);
        return await res.json();
      } catch (error) {
        return { error: error.message };
      }
    }

    async function testAPI() {
      const result = await apiCall(`${API_BASE}/`);
      document.getElementById('testResult').textContent = JSON.stringify(result, null, 2);
    }

    async function testDatabase() {
      const result = await apiCall(`${API_BASE}/test`);
      document.getElementById('testResult').textContent = JSON.stringify(result, null, 2);
    }

    async function uploadLog() {
      const file = document.getElementById('logfileInput').files[0];
      if (!file) return alert("Bitte Datei ausw√§hlen");

      const formData = new FormData();
      formData.append("logfile", file);

      try {
        const res = await fetch(`${API_BASE}/upload-log`, {
          method: "POST",
          body: formData
        });
        const data = await res.json();
        document.getElementById("uploadResult").textContent = data.message || data.error || JSON.stringify(data, null, 2);
      } catch (err) {
        document.getElementById("uploadResult").textContent = "Fehler beim Upload";
      }
    }
  </script>
</body>
</html>
